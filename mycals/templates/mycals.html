{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <title>FitTrack</title>

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <!-- Core styles: Bootstrap, animations, icon library, and main stylesheet -->
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="{% static 'css/aos.css' %}">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

    <body>

        <!-- NAVBAR SECTION AND FUNCTIONALITY -->
        <nav class="navbar navbar-expand-lg fixed-top">
            <div class="container-fluid justify-content-between d-flex align-items-center">

                <!-- Brand logo + name -->
                <a class="navbar-brand d-flex align-items-center me-auto" href="{% url 'home' %}">
                    <img src="{% static 'images/logo.png' %}"
                        alt="FitTrack Logo"
                        style="margin-right:10px; width:60px; height:auto;">
                    <h3 class="mb-0">FitTrack</h3>
                </a>

                <!-- Mobile toggler -->
                <button class="navbar-toggler" type="button"
                        data-toggle="collapse" data-target="#navbarNav"
                        aria-controls="navbarNav" aria-expanded="false"
                        aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Navigation links and menu -->
                <div class="collapse navbar-collapse" id="navbarNav">

                    <ul class="navbar-nav mx-auto">
                        <li class="nav-item mx-2"><a class="nav-link" href="{% url 'home' %}">Home</a></li>
                        <li class="nav-item mx-2"><a class="nav-link" href="{% url 'home' %}#programs">Programs</a></li>
                        <li class="nav-item mx-2"><a class="nav-link" href="{% url 'home' %}#bmi">My BMI</a></li>
                        <li class="nav-item mx-2"><a class="nav-link active" href="{% url 'mycals' %}">My CALS</a></li>
                        <li class="nav-item mx-2"><a class="nav-link" href="{% url 'aboutus' %}">About Us</a></li>
                        <li class="nav-item mx-2"><a class="nav-link" href="{% url 'contact' %}">Contact</a></li>
                        <li class="nav-item mx-2"><a class="nav-link" href="{% url 'fitshop' %}">FitShop</a></li>
                    </ul>

                    <!-- Search bar -->
                    <div class="search-container ms-auto">
                        <input type="text" id="navSearch" placeholder="Search..." />
                        <button id="searchBtn" type="button">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <!-- ADMIN BUTTON ONLY FOR STAFF MEMBERS -->
                    {% if user.is_authenticated and user.is_staff %}
                        <a href="{% url 'dashboard-home' %}" class="admin-btn me-4">
                            Admin Page
                        </a>
                    {% endif %}

                    <!-- User controls -->
                    <div class="user-controls d-flex align-items-center">

                        {% if user.is_authenticated %}

                            {% if not user.is_staff %}
                                <!-- Profile dropdown only for users that are authenticated -->
                                <div class="profile-dropdown">

                                    <button class="nav-icon profile-toggle" id="profileToggle" title="Profile">
                                        <i class="fa fa-user" style="font-size: 18px;"></i>
                                    </button>

                                    <div class="dropdown-menu" id="profileMenu">
                                        <a href="{% url 'profile' %}" class="dropdown-item">View Profile</a>

                                        <!-- Show become member option only to authenticated users and non member users -->
                                        {% if not user.profile.is_member %}
                                            <div class="upgrade-badge">
                                                <a href="{% url 'membership_upgrade' %}"
                                                class="dropdown-item">Upgrade to Premium Member</a>
                                            </div>
                                        {% endif %}

                                        <a href="{% url 'logout' %}" class="dropdown-item">Logout</a>
                                    </div>
                                </div>

                                <!-- Cart icon for fitshop that dynamically updates based on the number of items inside it-->
                                <a href="{% url 'view_cart' %}" class="cart-icon-wrapper">
                                    <i class="fa fa-shopping-cart nav-icon"></i>

                                    {% if cart_count > 0 %}
                                        <sup class="cart-superscript">{{ cart_count }}</sup>
                                    {% endif %}
                                </a>
                                
                            {% endif %}

                        {% else %}

                            <!-- Log in icon for the visitors -->
                            <a href="#" class="nav-icon" id="openLogin" title="Login">
                                <i class="fa fa-sign-in"></i>
                            </a>

                        {% endif %}


                    </div>
                </div>
            </div>
        </nav>

        <!-- ABOUT CALORIES SECTION AND FUNCTIONALITY -->
        <section class="about section" id="aboutcals">
            <div class="container">

                <!-- Awareness intro -->
                <section class="about section py-5" id="about">
                    <div class="container">

                        <div class="row align-items-center justify-content-center
                                    text-center text-lg-start mb-5">

                            <!-- Left: text -->
                            <div class="col-lg-6 col-md-10 mb-4 mb-lg-0"
                                data-aos="fade-up" data-aos-delay="200">

                                <h2 class="mb-4 fw-bold">Are You Really Aware of What You Eat?</h2>

                                <p>
                                    Every bite counts — but most people underestimate how much they actually consume in a day.
                                    Calorie tracking bridges the gap between intention and reality, helping you see the full picture of your nutrition.
                                </p>

                                <p>
                                    It’s not about restriction — it’s about awareness. When you know what fuels your body,
                                    you can make smarter choices, reach your fitness goals faster, and maintain long-term balance.
                                </p>
                            </div>

                            <!-- Right: image -->
                            <div class="col-lg-6 col-md-12 text-center"
                                data-aos="fade-up" data-aos-delay="300">
                                <img src="{% static 'images/calories.webp' %}"
                                    class="img-fluid rounded shadow"
                                    alt="Our Mission">
                            </div>

                        </div>

                    </div>
                </section>

                <!-- HEADER FOR CALORIE TRACKING -->
                <div class="row text-center mb-5">
                    <div class="col-lg-8 col-md-10 mx-auto">

                        <h2 data-aos="fade-up" data-aos-delay="300">Track Your Daily Calories Now</h2>

                        <p data-aos="fade-up" data-aos-delay="400">
                            Small steps make big changes — start today by keeping track of what fuels your body.
                            Every meal, every snack, and every choice adds up.
                        </p>

                    </div>
                </div>

                <!-- MAIN CALORIE TRACKING SYSTEM -->
                <section class="fittrack-mycals container">

                    {% if auth_required %}

                    <!-- Friendly reminder for logged-out users -->
                    <div class="text-center mt-5 mb-5 p-5 shadow-sm rounded-4 auth-alert"
                        data-aos="fade-up" data-aos-delay="200">

                        <h4 class="fw-bold mb-3" style="color:#ff8c42;">
                            <i class="fa fa-lock me-2"></i>
                            You must log in to access the Calorie Tracking dashboard
                        </h4>

                        <p class="text-secondary mb-4" style="font-size:1.05rem;">
                            Track your calories, view your stats, and personalize your nutrition.
                        </p>

                        <div class="auth-buttons">
                            <a href="#" id="openSignup" class="btn-fittrack">Sign Up</a>
                            <a href="#" id="openLoginMain" class="btn-fittrack me-3">Log In</a>
                        </div>

                    </div>

                    {% else %}

                    <!-- ADD FOOD INPUT BAR -->
                    <form method="POST" class="add-food-bar" autocomplete="off">
                        {% csrf_token %}

                        <label for="foodField" class="add-food-label"
                            data-aos="fade-up" data-aos-delay="300">
                            Type a food to add
                        </label>

                        <div class="add-food-inputs">

                            <input id="foodField" name="food_consumed"
                                class="add-food-input"
                                type="text"
                                placeholder="e.g., Banana, Chicken breast, Rice"
                                data-aos="fade-up" data-aos-delay="300"
                                required />

                            <button type="submit"
                                    class="add-food-btn"
                                    data-aos="fade-up" data-aos-delay="300">
                                <span class="icon">+</span> Add
                            </button>

                        </div>
                    </form>

                    <!-- Food not found popup -->
                    {% if error_message %}
                    <script>
                    Swal.fire({
                        icon: 'error',
                        title: 'Food Not Found',
                        text: "{{ error_message|safe }}",
                        confirmButtonColor: '#ff8c42'
                    });
                    </script>
                    {% endif %}

                    <!-- TABLE + CHART WRAPPER -->
                    <div class="fittrack-today-wrapper">

                        <!-- Today's food table (left) -->
                        <div class="fittrack-mycals-consumption"
                            data-aos="fade-left" data-aos-delay="300">

                            <h3 class="table-title">Today's Consumption</h3>

                            <div class="food-table-wrapper">

                                <table class="food-table">

                                    <thead>
                                        <tr>
                                            <th>Food Item</th>
                                            <th>Carbs (g)</th>
                                            <th>Protein (g)</th>
                                            <th>Fats (g)</th>
                                            <th>Calories (Kcal)</th>
                                            <th>Remove</th>
                                        </tr>
                                    </thead>

                                    <tbody>
                                        {% for c in consumed_food %}
                                        <tr>
                                            <td>{{ c.food_consumed.name }}</td>
                                            <td>{{ c.food_consumed.carbs }}</td>
                                            <td>{{ c.food_consumed.protein }}</td>
                                            <td>{{ c.food_consumed.fats }}</td>
                                            <td>{{ c.food_consumed.calories }}</td>
                                            <td><a href="{% url 'delete_food' c.pk %}" class="remove-btn">X</a></td>
                                        </tr>
                                        {% empty %}
                                        <tr>
                                            <td colspan="6" class="empty-msg">No foods added yet</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>

                                    <tfoot>
                                        <tr class="table-total">
                                            <td>Total</td>
                                            <td id="totalCarbs"></td>
                                            <td id="totalProtein"></td>
                                            <td id="totalFats"></td>
                                            <td id="totalCalories"></td>
                                            <td></td>
                                        </tr>
                                    </tfoot>

                                </table>

                            </div>
                        </div>

                        <!-- Nutrients breakdown chart (right) -->
                        <div class="fittrack-breakdown"
                            data-aos="fade-right" data-aos-delay="300">

                            <h3 class="table-title">Today's Breakdown</h3>
                            <h4 class="chart-subtitle">Nutrients breakdown</h4>

                            <canvas id="nutrientsChart"></canvas>
                        </div>

                    </div>

                    {% endif %}

                </section>

            </div>
        </section>

        <!-- FOOTER SECTION AND FUNCTIONALITY-->
        <footer class="site-footer">
            <div class="container">
                <div class="row">

                    <!-- About text -->
                    <div class="col-lg-3 col-md-6 footer-about">
                        <h3 class="footer-text">FitTrack</h3>

                        <p class="text-light small lh-base mb-0">
                            FitTrack is dedicated to helping you stay motivated and consistent
                            on your fitness journey. Whether you train at home or in the gym,
                            we’re here to keep you on track every step of the way.
                        </p>

                        <br />
                    </div>

                    <!-- Our Blogs dynamically loaded -->
                    <div class="col-lg-3 col-md-6 footer-blog">
                        <h5 class="footer-title">Our Blogs</h5>
                        <ul>

                        <!-- Loads the recent blogs created from the admin -->
                        {% if recent_blogs %}
                            {% for blog in recent_blogs %}
                            <li>
                                <a class="text-light small lh-base mb-0" 
                                href="{% url 'blog_detail' blog.id %}">
                                    <!-- The first letter of the blog name is capitalized -->
                                    {{ blog.title|lower|capfirst }} 
                                </a>
                                
                                <!-- Show whne blog was created-->
                                <span>{{ blog.created_at|date:"M d, Y" }}</span>
                            </li>
                            {% endfor %}

                        <!-- If no blogs exist, goes to this block -->
                        {% else %}
                            <li>
                                <span class="text-muted small">No blogs available</span>
                            </li>
                        {% endif %}
                    </div>

                     <!-- Contact info (phone number, email and address)-->
                    <div class="col-lg-2 col-md-6 footer-info">
                        <h5 class="footer-title">Get Info</h5>

                        <p class="text-light small lh-base mb-2">
                            <i class="fa fa-phone"></i> (+30) 210 4567890
                        </p>

                        <p class="text-light small lh-base mb-2">
                            <i class="fa fa-envelope"></i> info@fittrack.com
                        </p>

                        <p class="text-light small lh-base mb-2">
                            <i class="fa fa-map-marker"></i> 28 Ermou Street, Athens, Greece
                        </p>

                        <br />
                    </div>

                    <!-- Social links (instagram, facebook and twitter)-->
                    <div class="col-lg-2 col-md-6 footer-social text-center">
                        <h5 class="footer-title">Follow&nbsp;Us&nbsp;On</h5>

                        <div class="footer-social">
                            <a href="https://www.facebook.com/" class="me-3">
                                <i class="fa-brands fa-facebook-f"></i>
                            </a>

                            <a href="https://x.com/" class="me-3">
                                <i class="fa-brands fa-x-twitter"></i>
                            </a>

                            <a href="https://www.instagram.com/" class="me-3">
                                <i class="fa-brands fa-instagram"></i>
                            </a>
                        </div>

                    </div>

                </div>
            </div>
        </footer>

        <!-- External js scripts for functionality -->
        <script src="{% static 'js/jquery.min.js' %}"></script>
        <script src="{% static 'js/bootstrap.min.js' %}"></script>
        <script src="{% static 'js/aos.js' %}"></script>
        <script src="{% static 'js/smoothscroll.js' %}"></script>
        <script src="{% static 'js/custom.js' %}"></script>
        <script src="{% static 'js/activelink.js' %}"></script>
        <script src="{% static 'js/searchbar.js' %}"></script>
        <script src="{% static 'js/calstabletotal.js' %}"></script>
        <script src="{% static 'js/mycalsscrollreset.js' %}"></script>
        <script src="{% static 'js/calschart.js' %}"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script src="{% static 'js/profiledropdown.js' %}"></script>
        <script src="{% static 'js/chatbot.js' %}"></script>

        <!-- Include login modal, signup modal and the chatbot -->
        {% include 'accounts/login.html' %}
        {% include 'accounts/signup.html' %}
        {% include 'chatbot.html' %}

    </body>
</html>
